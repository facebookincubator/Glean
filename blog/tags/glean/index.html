<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">2 posts tagged with &quot;glean&quot; | Glean</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://glean.software/blog/tags/glean/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="2 posts tagged with &quot;glean&quot; | Glean"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://glean.software/blog/tags/glean/"><link data-rh="true" rel="alternate" href="https://glean.software/blog/tags/glean/" hreflang="en"><link data-rh="true" rel="alternate" href="https://glean.software/blog/tags/glean/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Glean RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Glean Atom Feed"><link rel="stylesheet" href="/assets/css/styles.34be974f.css">
<link rel="preload" href="/assets/js/runtime~main.81aa6f5b.js" as="script">
<link rel="preload" href="/assets/js/main.47cdac54.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Glean</b></a><a class="navbar__item navbar__link" href="/docs/introduction/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/release-0-2/">Glean Release 0.2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/incremental/">Incremental indexing with Glean</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;glean&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/release-0-2/">Glean Release 0.2</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2026-02-06T00:00:00.000Z" itemprop="datePublished">February 6, 2026</time> Â· <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://simonmar.github.io/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="http://simonmar.github.io/images/simonmarlow.jpg" alt="Simon Marlow"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://simonmar.github.io/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Simon Marlow</span></a></div><small class="avatar__subtitle" itemprop="description">Simon Marlow</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I just uploaded
<a href="https://hackage.haskell.org/package/glean-0.2.0.0" target="_blank" rel="noopener noreferrer">glean-0.2.0.0</a> to
Hackage, along with releases of the Haskell Thrift compiler and other
dependencies.</p><p>Since version 0.1.0.0, Glean has been installable using plain <code>cabal
install</code> which vastly improves on the previous complex build
process. For full details, see <a href="https://glean.software/docs/building/" target="_blank" rel="noopener noreferrer">Building Glean From
Source</a>, but to summarise: on a
recent Linux distro, with GHC 9.2-9.6 and cabal 3.6+, install some
prerequisite system packages (listed in the building docs above), and
then just</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cabal install glean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The build takes a while, partly because one of the dependencies is a
cabal-packaged copy of the &quot;folly&quot; C++ library
(<a href="https://hackage.haskell.org/package/folly-clib" target="_blank" rel="noopener noreferrer">folly-clib</a>) and
<a href="https://github.com/haskell/cabal/issues/7127" target="_blank" rel="noopener noreferrer">cabal doesn&#x27;t currently build C++ files in
parallel</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changes-in-0200">Changes in 0.2.0.0<a class="hash-link" href="#changes-in-0200" title="Direct link to heading">â€‹</a></h2><p>Some pretty big things have landed:</p><ul><li><p>Glean now comes with a generic LSP server,
<a href="https://hackage.haskell.org/package/glean-lsp" target="_blank" rel="noopener noreferrer">glean-lsp</a>, which
supports common IDE operations like go-to-definition,
go-to-references, hover documentation, and symbol search. This means
you can index a software project with Glean and then browse it using
VS Code (for example). I&#x27;ll give a couple of worked examples below
showing step-by-step how to do this for some real world codebases.</p></li><li><p>Glean has a new experimental DB backend based on
<a href="https://www.symas.com/mdb" target="_blank" rel="noopener noreferrer">LMDB</a>. LMDB is much smaller and simpler
than RocksDB, and in most of our benchmarks it performed around
30-40% better. We&#x27;re still investigating some performance issues
encountered with very large indexing jobs, though. Currently it&#x27;s
still not possible to build Glean without the RockDB dependency,
but we do intend to fix this in the future.</p></li><li><p>Added a new Haskell indexer that consumes <code>.hie</code> files directly, and
collects much richer data than the old indexer - in particular it
indexes local variables and collects type information for all
variable occurrences, which appears on hover with <code>glean-lsp</code> and VS
Code.</p></li><li><p>We&#x27;re now also releasing the C++ indexer as a Cabal package along
with Glean:
<a href="https://hackage.haskell.org/package/glean-clang" target="_blank" rel="noopener noreferrer">glean-clang</a>, so
Glean can be used to index C++ projects out of the box.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">â€‹</a></h2><p>Here are a couple of things you can play with, once you&#x27;ve <a href="https://glean.software/docs/building/" target="_blank" rel="noopener noreferrer">built and
installed Glean</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="index-llvm--clang-and-browse-it-in-vs-code">Index LLVM + Clang and browse it in VS Code<a class="hash-link" href="#index-llvm--clang-and-browse-it-in-vs-code" title="Direct link to heading">â€‹</a></h3><p>Clone an LLVM source tree:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/llvm/llvm-project.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Configure, including Clang. This step also produces the
<code>compile_commands.json</code> file that Glean will later use during
indexing:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd llvm-project/llvm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build &amp;&amp; cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DCMAKE_BUILD_TYPE=Debug -DLLVM_ENABLE_PROJECTS=clang ..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, build LLVM. This step is required because LLVM includes a lot of
generated code which is produced as part of the build process, so to
index the source files we need to ensure all the generated code has
been built first.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake --build . -j12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Go and get a coffee. Or two. (beware, even with 32GB this tends to OOM
my laptop, so you might want to reduce <code>-j12</code> to something
lower). Next, we can index the project using Glean&#x27;s C++
indexer.</p><p>If you haven&#x27;t already install Glean&#x27;s C++ indexer, do that:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cabal install glean-clang</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next we&#x27;ll run the indexer. We&#x27;ll store the resulting DB in
<code>llvm-project/gleandb</code> for now.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd ..</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean --db-root gleandb index cpp-cmake --db llvm/1 --cdb-dir &quot;$(pwd)/llvm/build&quot; . -j12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Go and get another coffee... this is essentially running the compiler
over all the C++ code again. It <em>should</em> need no more than 16GB or so
with 12 indexer processes running in parallel.</p><p>Note that you need to do this from the <code>llvm-project</code> directory, this
ensures that the filenames in the Glean DB will be relative to that
directory which is what <code>glean-lsp</code> expects. (Storing the data under
the wrong filenames is the most common cause of things not working
when we connect up the full IDE/LSP/Glean stack).</p><p>Next we need to set up VS Code and <code>glean-lsp</code>. There are full
instructions for <code>glean-lsp</code> in its <a href="https://github.com/facebookincubator/Glean/tree/master/lsp/README.md">README</a>, but here&#x27;s specifically how
to set it up for LLVM using the index we just created.</p><p>First install <code>glean-lsp</code> if you haven&#x27;t already:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cabal install glean-lsp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To use this LSP server with VS Code, you need a generic LSP client
such as <a href="https://github.com/zsol/vscode-glspc" target="_blank" rel="noopener noreferrer">Generic LSP Client
(v2)</a>. Install that extension in
VS Code, and then create <code>llvm-project/.vscode/settings.json</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;glean-lsp&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;repo&quot;: &quot;llvm&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;glspc.server.command&quot;: &quot;glean-lsp&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;glspc.server.commandArguments&quot;: [&quot;--db-root&quot;, &quot;gleandb&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;glspc.server.languageId&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;cpp&quot;, &quot;c&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now in VS Code, &quot;Open Folder&quot; and select the <code>llvm-project</code> folder. If
you have another C++ extension installed, it probably makes sense to
disable it for this folder, otherwise you&#x27;ll see responses from both
extensions for things like go-to-definition.</p><p>Open a source file,
e.g. <code>llvm-project/clang/include/clang/AST/Decl.h</code>.  You should have
code navigation features available: holding down Ctrl while moving the
mouse around should underline identifiers, and clicking on an
identifier should jump to its definition. You should be able to
right-click &quot;Go to References&quot; on a definition to find references
throughout the whole LLVM + Clang tree instantly, and <code>Ctrl+T</code> for
symbol search should work. Hovering the mouse over an identifier
should show its type.</p><p>If things aren&#x27;t working, then the first place to look for problems is in
the output window for the Generic LSP Client: show the Output window,
and then select Generic LSP Client from the dropdown on the right.</p><p>You can also open the DB in Glean&#x27;s shell to check that it looks right:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean shell --db-root llvm-project/gleandb --db llvm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Try e.g. <code>:stat</code> to see the contents, and try <code>src.File _</code> to show
known source files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-a-db-of-stackage-and-try-some-queries">Download a DB of Stackage and try some queries<a class="hash-link" href="#download-a-db-of-stackage-and-try-some-queries" title="Direct link to heading">â€‹</a></h3><p>You can <a href="https://drive.google.com/file/d/1rixJ6VCl6OlsECGnSjsH6IlXxFUU_msD/view?usp=sharing" target="_blank" rel="noopener noreferrer">download a DB of Stackage
21.21</a>
and try some queries. This DB was produced by building ~3000 packages
in Stackage 21.21 and then producing a Glean DB from the <code>.hie</code> files;
for more details see <a href="https://simonmar.github.io/posts/2025-05-22-Glean-Haskell.html" target="_blank" rel="noopener noreferrer">Indexing Hackage: Glean
vs. hiedb</a>.</p><p>Unpack the DB:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir /tmp/glean &amp;&amp; tar xf glean-stackage-21.21.tar -C /tmp/glean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and start the Glean shell:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean shell --db-root /tmp/glean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Glean Shell, built on 2025-07-14 13:39:35.711312749 UTC, from rev &lt;unknown&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using local DBs from rocksdb:/tmp/glean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type :help for help.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Load the DB:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; :db stackage/1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see what&#x27;s in it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; :stat</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hs.ClassDecl.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 6503</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  350074 (341.87 kiB) 0.0309%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hs.ConstrDecl.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 89371</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  4048652 (3.86 MiB) 0.3569%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hs.DataDecl.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 40711</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  2017999 (1.92 MiB) 0.1779%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total: 21735709 facts (1.06 GiB)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s find the class declaration for <code>Hashable</code>. First we have to find
its name:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; hs.Name { occ = { name = &quot;Hashable&quot; }}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 11500325,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;occ&quot;: { &quot;id&quot;: 11923, &quot;key&quot;: { &quot;name&quot;: &quot;Hashable&quot;, &quot;namespace_&quot;: 3 } },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;mod&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;id&quot;: 733072,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: { &quot;id&quot;: 733071, &quot;key&quot;: &quot;Language.Preprocessor.Cpphs.SymTab&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;unit&quot;: { &quot;id&quot;: 560159, &quot;key&quot;: &quot;cpphs-1.20.9.1-inplace&quot; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sort&quot;: { &quot;external&quot;: { } }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5 results, 20 facts, 7.40ms, 316816 bytes, 914 compiled bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We got 5 results, and only one of them was the one we wanted. So let&#x27;s
restrict the query to find only results in the <code>hashable</code> package:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; hs.Name { occ = { name = &quot;Hashable&quot; }, mod = { unit = &quot;hashable&quot;.. }}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 11924,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;occ&quot;: { &quot;id&quot;: 11923, &quot;key&quot;: { &quot;name&quot;: &quot;Hashable&quot;, &quot;namespace_&quot;: 3 } },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;mod&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;id&quot;: 11922,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: { &quot;id&quot;: 11920, &quot;key&quot;: &quot;Data.Hashable.Class&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;unit&quot;: { &quot;id&quot;: 11921, &quot;key&quot;: &quot;hashable-1.4.3.0-inplace&quot; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sort&quot;: { &quot;external&quot;: { } }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 results, 5 facts, 1.18ms, 353848 bytes, 1489 compiled bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>OK, now let&#x27;s find the class declaration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; hs.ClassDecl { name = { occ = { name = &quot;Hashable&quot; }, mod = { unit = &quot;hashable&quot;.. }}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 19072033,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;id&quot;: 11924,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;occ&quot;: { &quot;id&quot;: 11923, &quot;key&quot;: { &quot;name&quot;: &quot;Hashable&quot;, &quot;namespace_&quot;: 3 } },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;mod&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;id&quot;: 11922,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: { &quot;id&quot;: 11920, &quot;key&quot;: &quot;Data.Hashable.Class&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;unit&quot;: { &quot;id&quot;: 11921, &quot;key&quot;: &quot;hashable-1.4.3.0-inplace&quot; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;sort&quot;: { &quot;external&quot;: { } }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;methods&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 results, 15 facts, 6.45ms, 514328 bytes, 1777 compiled bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s find the method names of the class:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; (C.methods[..]).name.occ.name where C = hs.ClassDecl { name = { occ = { name = &quot;Hashable&quot; }, mod = { unit = &quot;hashable&quot;.. }}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 21736733, &quot;key&quot;: &quot;hashWithSalt&quot; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 21736734, &quot;key&quot;: &quot;hash&quot; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And finally, let&#x27;s see how many instances in Stackage 21.21 provide a
definition of <code>hashWithSalt</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; :count I where B = hs.InstanceBind { name = { occ = { name = &quot;hashWithSalt&quot; }, mod = { unit = &quot;hashable&quot;.. }}}; hs.InstanceBindToDecl { bind = B, decl = { inst = I }}; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">267 results, 267 facts, 26.40ms, 644736 bytes, 2462 compiled bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To see where these instance declarations are:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage&gt; I.loc where B = hs.InstanceBind { name = { occ = { name = &quot;hashWithSalt&quot; }, mod = { unit = &quot;hashable&quot;.. }}}; hs.InstanceBindToDecl { bind = B, decl = { inst = I }}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 21736733,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;file&quot;: { &quot;id&quot;: 3982208, &quot;key&quot;: &quot;text-latin1-0.3.1/src/Text/Latin1.hs&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;span&quot;: { &quot;start&quot;: 2662, &quot;length&quot;: 157 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 21736734,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;file&quot;: { &quot;id&quot;: 11054592, &quot;key&quot;: &quot;shake-0.19.7/src/General/Thread.hs&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;span&quot;: { &quot;start&quot;: 526, &quot;length&quot;: 87 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 21736735,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;file&quot;: { &quot;id&quot;: 5786370, &quot;key&quot;: &quot;strict-tuple-0.1.5.3/src/Data/Tuple/Strict/T6.hs&quot; },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;span&quot;: { &quot;start&quot;: 1887, &quot;length&quot;: 265 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are also some example queries in an <a href="https://simonmar.github.io/posts/2025-05-22-Glean-Haskell.html" target="_blank" rel="noopener noreferrer">earlier blog
post</a> (however, the</p><a href="https://github.com/facebookincubator/Glean/tree/master/glean/schema/source/hs.angle">schema</a>for Haskell has changed in a few ways since that post so some of the queries might not work exactly as written).<h3 class="anchor anchorWithStickyNavbar_LWe7" id="index-your-own-haskell-code">Index your own Haskell code<a class="hash-link" href="#index-your-own-haskell-code" title="Direct link to heading">â€‹</a></h3><p>To index the code of a Cabal package, add the following to your <code>cabal.project</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ghc-options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        -fwrite-ide-info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        -hiedir .hiefiles</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cabal build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean index haskell-hie --db-root /tmp/glean --db mydb/1 .hiefiles</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and then you can query the new DB in the shell:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean shell --db-root /tmp/glean --db mydb/1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-a-glass-server-and-make-some-simple-queries">Run a Glass server and make some simple queries<a class="hash-link" href="#run-a-glass-server-and-make-some-simple-queries" title="Direct link to heading">â€‹</a></h3><p>Glass is a &quot;symbol server&quot;, it provides a higher-level interface to
the Glean data, with operations like <code>documentSymbols</code> for finding all
the symbols in a file, and <code>findReferences</code> for finding all the
references to a symbol. I used Glass to connect VS Code to Glean in
the <a href="https://simonmar.github.io/posts/2025-06-11-Glean-stackage-vscode.html" target="_blank" rel="noopener noreferrer">previous blog
post</a>.</p><p>Glass makes requests to a Glean server, so we need to start both
<code>glean-server</code> and <code>glass-server</code>, like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean-server --db-root /tmp/glean --port 12345</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and in another terminal:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glass-server --service localhost:12345 --port 12346</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then we can make requests using <code>glean-democlient</code>, for example to
list the symbols in the file <code>src/Data/Aeson.hs</code> in the <code>aeson-2.1.2.1</code> package:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glass-democlient --service localhost:12346 list stackage/aeson-2.1.2.1/src/Data/Aeson.hs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/eitherDecodeFileStrict</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/eitherDecodeFileStrict%27</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/eitherDecodeStrict</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/fp/4335/2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/eitherDecodeStrict%27</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/tyvar/a/6101/50</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/tyvar/a/6563/56</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/var/encodeFile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stackage/hs/aeson/Data/Aeson/tyvar/a/7047/61</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each of those symbols is a &quot;Symbol ID&quot;, which is a string that
uniquely identifies a particular symbol to Glass. Using the Symbol ID
we can find all the references to a symbol:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/glean/">glean</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/release/">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/incremental/">Incremental indexing with Glean</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-01T00:00:00.000Z" itemprop="datePublished">December 1, 2022</time> Â· <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://simonmar.github.io/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="http://simonmar.github.io/images/simonmarlow.jpg" alt="Simon Marlow"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://simonmar.github.io/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Simon Marlow</span></a></div><small class="avatar__subtitle" itemprop="description">Simon Marlow</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>  This post describes how Glean supports <em>incremental indexing</em> of
source code, to maintain an up-to-date index of a large repository
using minimal resources. This is an overview of the problems and
some aspects of how we solved them; for the technical details of the
implementation see <a href="/docs/implementation/incrementality/">Implementation Notes:
Incrementality</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">â€‹</a></h2><p>Indexing a large amount of source code can take a long time. It&#x27;s not
uncommon for very large indexing jobs to take multple
hours. Furthermore, a monolithic indexing job produces a large DB that
can be slow to ship around, for example to replicate across a fleet of
Glean servers.</p><p>Source code changes often, and we would like to keep the index up to
date, but redoing the monolithic indexing job for every change is out
of the question. Instead what we would like to do is to update a
monolithic index with the <em>changes</em> between the base revision and the
current revision, which should hopefully be faster than a full
repository indexing job because we only have to look at the things
that have changed. The goal is to be able to index the changes in
<em>O(changes)</em> rather than <em>O(repository)</em>, or as close to that as we
can get.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-incrementality-works">How incrementality works<a class="hash-link" href="#how-incrementality-works" title="Direct link to heading">â€‹</a></h2><p>To produce a modified DB, we hide a portion of the data in the
original DB, and then stack a DB with the new data on top. Like this:</p><p><img loading="lazy" alt="Incremental stack" src="/assets/images/stack-f1841961d75a1c2d4d1338f3d18f0179.jpg" width="569" height="458" class="img_ev3q"></p><p>The user asks for the DB &quot;new&quot;, and they can then work with the data
in exactly the same way as they would for a single DB. The fact that
the DB is a stack is invisible to a user making queries. Furthermore,
the DB &quot;old&quot; still exists and can be used simultaneously, giving us
access to multiple versions of the DB at the same time. We can even
have many different versions of &quot;new&quot;, each replacing a different
portion of &quot;old&quot;.</p><p>All of the interesting stuff is in how we hide part of the data in the
old DB.  How do we hide part of the data?</p><p>When facts are added to a Glean DB, the producer of the facts can
label facts with a <em>unit</em>. A unit is just a string; Glean doesn&#x27;t impose
any particular meaning on units so the indexer can use whatever
convention it likes, but typically a unit might be a filename or
module name. For example, when indexing a file F, the indexer would
label all the facts it produces with the unit F.</p><p>To hide some of the data in a DB, we specify which units to exclude
from the base DB, like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean create --repo &lt;new&gt; --incremental &lt;old&gt; --exclude A,B,C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>would create a DB <code>&lt;new&gt;</code> that stacks on top of <code>&lt;old&gt;</code>, hiding units A, B
and C.</p><p>So to index some code incrementally, we would first decide which files
need to be reindexed, create an incremental DB that hides those files
from the base DB and then add the new facts.</p><p>To implement hiding correctly, Glean has to remember which facts are
owned by which units. But it&#x27;s not quite that simple, because facts
can refer to each other, and the DB contents must be valid (which has
a formal definition but informally means &quot;no dangling
references&quot;). For example, if we have facts <strong>x</strong> and <strong>y</strong>, where <strong>x</strong> refers to
<strong>y</strong>:</p><p><img loading="lazy" alt="Fact dependency" src="/assets/images/factdep1-59c2c6ff2bb70cadfffaa8ed1c3c725c.jpg" width="380" height="229" class="img_ev3q"></p><p>and we hide unit B, then <strong>y</strong> must still be visible, otherwise the
reference from <strong>x</strong> would be dangling and the DB would not be valid.</p><p>So after the indexer has finished producing facts, Glean propagates
all the units through the graph of facts, resulting in a mapping from
facts to <strong>ownership sets</strong>.</p><p><img loading="lazy" alt="Fact dependency with ownership sets" src="/assets/images/factdep2-ee89a8cde4e367c8d2e99fde1b9553a0.jpg" width="389" height="227" class="img_ev3q"></p><p>It turns out that while there are lots of facts, there are relatively
few distinct ownership sets. Furthermore, facts produced together tend
to have the same ownership set, and we can use this to store the
mapping from facts to ownership sets efficiently. To summarise:</p><ul><li>Ownership sets are assigned unique IDs and stored in the DB using <a href="https://github.com/facebook/folly/blob/main/folly/experimental/EliasFanoCoding.h" target="_blank" rel="noopener noreferrer">Elias Fano Coding</a></li><li>The mapping from facts to ownership sets is
stored as an interval map</li></ul><p>As a result, keeping all this information only adds about 7% to the DB
size.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-derived-facts">What about derived facts?<a class="hash-link" href="#what-about-derived-facts" title="Direct link to heading">â€‹</a></h3><p>Derived facts must also have ownership sets, because we have to know
which derived facts to hide. When is a derived fact visible? When all
of the facts that it was derived from are visible.</p><p>For example, if we have a fact <strong>r</strong> that was derived from <strong>p</strong> and <strong>q</strong>:</p><p><img loading="lazy" alt="Derived fact" src="/assets/images/derived-e46b2a6e3925959133e37b75619495a6.jpg" width="881" height="268" class="img_ev3q"></p><p>The ownership set of <strong>r</strong> is <code>{ P } &amp; { Q }</code>, indicating that it should be
visible if both P and Q are visible. Note that facts might be derived
from other derived facts, so these ownership expressions can get
arbitrarily large. Normalising them to disjunctive normal form would
be possible, but we haven&#x27;t found that to be necessary so far.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">â€‹</a></h3><p>There are three aspects to performance:</p><ul><li><strong>Indexing performance</strong>. We measured the impact of computing
ownership at indexing time to be 2-3% for Python, for Hack it was in
the noise, and we don&#x27;t
expect other languages to be significantly different.</li><li><strong>Query performance</strong>. Initially query performance for an
incremental stack was much slower because we have to calculate the visibility of every fact discovered during a query. However, with some <a href="/docs/implementation/incrementality/#caching-fact-ownership">caching optimisations</a> we were able to get the overhead to less than 10% for &quot;typical&quot; queries, of the kind that Glass does. Queries that do a lot of searching may be impacted by around 3x, but these are not typically found in production use cases.</li><li><strong>Incremental derivation performance</strong>. We would like derivation in the incremental DB to take time proportional to the number of facts in the increment. We implemented incremental derivation for some kinds of query; optimising queries to achieve this in general is a hard problem that we&#x27;ll return to probably next year.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stacked-incremental-dbs">Stacked incremental DBs<a class="hash-link" href="#stacked-incremental-dbs" title="Direct link to heading">â€‹</a></h3><p>So far we have only been considering how to stack a single increment
on top of a base DB. What if we want to create deeper stacks?</p><p><img loading="lazy" alt="Stacked incremental database" src="/assets/images/stacked-incremental-a591470e7df3a05595e75f76fad1a7ac.jpg" width="564" height="633" class="img_ev3q"></p><p>The DB &quot;newer&quot; stacks on top of &quot;new&quot;, and hides some more units. So
there are now portions of both &quot;new&quot; and &quot;old&quot; that need to be hidden
(the darker grey boxes), in addition to the original portion of &quot;old&quot;
that we hid (light grey box).</p><p>As before, we might have multiple versions of &quot;newer&quot; stacked on top
of the same &quot;new&quot;, and in general these DB stacks form a tree. All the
intermediate nodes of the tree are usable simultaneously: no data is
being modified, only shared and viewed differently depending on which
node we choose as the top of our stack.</p><p>One interesting aspect that arises when we consider how to track
ownership of facts in this model is fact dependencies across the
boundaries between DBs.  For instance, suppose we have</p><p><img loading="lazy" alt="Stacked dependency" src="/assets/images/stacked-dependency-37bdf977436a2c7f69570eff127cb537.jpg" width="612" height="323" class="img_ev3q"></p><p>If we hide B, then considering the ownership data for &quot;old&quot; alone
would tell us that y is invisible. But we must make it visible,
because x depends on it. So when computing the ownership data for
&quot;new&quot;, we have to transitively propagate ownership to facts in the
base DB(s), store that in &quot;new&quot;, and consult it when deciding which
facts in &quot;old&quot; are visible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="derived-facts-in-stacked-incremental-dbs">Derived facts in stacked incremental DBs<a class="hash-link" href="#derived-facts-in-stacked-incremental-dbs" title="Direct link to heading">â€‹</a></h3><p>A fact might be derived from multiple facts in different DBs in the
stack, and we have to represent its ownership correctly. Therefore</p><ul><li>There must be a single namespace of ownership sets for the whole DB stack. That is, stacked DBs add more sets. (or else we copy ownership sets from the base DB, which doesn&#x27;t seem attractive).</li><li>Since a fact may be owned multiple different ways (see previous section) we have to take this into account when computing the ownership expression for a derived fact.</li></ul><p>This is the most complex diagram in the post (phew!):</p><p><img loading="lazy" alt="Stacked derived" src="/assets/images/stacked-derived-fc2ba3ed856040135fc526e8a7ff6391.jpg" width="804" height="446" class="img_ev3q"></p><p>Here the dashed arrow means &quot;derived from&quot; and the solid arrow means
&quot;refers to&quot;.</p><p>The fact <strong>d</strong> should be visible if both <strong>x</strong> and <strong>y</strong> are visible. The
ownership of <strong>x</strong> is <code>{A}</code> and <strong>y</strong> is <code>{B,C}</code> (because it is referred to from <strong>z</strong>
which has owner B), so the final owner of <strong>d</strong> is <code>{A} &amp;&amp; {B,C}</code>.</p><p>Tracking all this shouldn&#x27;t be too expensive, but it&#x27;s tricky to get
right!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/glean/">glean</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/incremental/">incremental</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/w3s6X6QAHZ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright Â© Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.81aa6f5b.js"></script>
<script src="/assets/js/main.47cdac54.js"></script>
</body>
</html>